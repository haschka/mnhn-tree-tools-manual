\section{split\_sets\_to\_newick} \label{sec-ssnewick}

This tool allows you to create a Newick \cite{newick} tree file from the
\emph{split-set} and \emph{output} files that have been generated by
an adaptive clustering run as outlined in section
\ref{sec-adaptive-clust}.

\subsection{Usage}

One can use the tool like:

\lstset{language=bash,
  caption={Calling the \emph{split\_sets\_to\_newick} tool},
  label=lst-ssnewick-call}
\begin{lstlisting}
split_sets_to_newick [filter] [lengths-from-output] [dimensions] \
  [outfile] [minPoints] [file1 ... filen] > [newick]
\end{lstlisting}
with arguments as follows:
\begin{enumerate}
  \item \emph{filter} One may use 0, for no filter, an other number for the
    minimum cluster size to occur in the resulting tree. Filtering
    like this works but changes the labels on the tree. For correct
    labels we suggest the user to filter with the
    \emph{filter\_split\_sets\_by\_min} tool, as shown in section
    \ref{sec-filter-split}, prior using this tool and
    apply no filter. This parameter is kept for conviniance.
  \item \emph{lengths-from-output} Use distances between nodes of the
    Newick tree using parameters found in the output file of an
    adaptive clustering run with a tool shown in section
    \ref{sec-adaptive-clust}. If you do not choose to use lengths
    proportional to density differences choose 0 here, choose 1 if
    your run uses an $L_1$ based distance calculation, and 2 if your
    run uses an $L_2$ based distance calculation. 1 uses a hypercube
    with a sidelength of $2\epsilon$ to calculated the volume, 2 uses
    a hypersphere with radius $\epsilon$.
  \item \emph{dimensions} As the lengths between the nodes correspond
    to density differences we need the dimensons to calculate the
    volume from the different $\epsilon$ radiuses found in the
    \emph{outfile} file. As a basic guidance choose the number of
    projections onto principal componants that you have used if this
    run was perfomed with PCA data. Otherwise choose 1 or a value to
    your convinience.
  \item \emph{outfile} The \emph{output} file from an adaptive
    clustering run generate from one of the tools outlined in section
    \ref{sec-filter-split}.
  \item \emph{minPoints} The \emph{minPoints} argument used during the
    adaptive clustering run, in order to correctly calculate the
    correct density differences.
  \item \emph{file1$\ldots$filen} All the \emph{split-set} files
    to use to built this tree from. In order to select them in general
    wildcards can used on shells like the bash by i.e. using something
    like \begin{verbatim}/path/prefix*\end{verbatim}.
  \item \emph{newick} The created Newick tree file. 
\end{enumerate}
The arguments \emph{dimensions}, \emph{outfile} and \emph{minPoints}
are to be omitted if 0 was chosen for the \emph{lengths-from-output}
argument.

\subsection{Algorithm}
If the lengths in the newick file are chosen to be density
differences, the density is calculated from the $\epsilon$ value in
the output file of an adaptive clustering run.
The formulas used for the volume are:
\begin{equation}
  V = (2\epsilon)^d,
\end{equation}
for the hypercube $L_1$ distance case, and
\begin{equation}
  V = \epsilon^{d}\frac{\pi^{d/2}}{\Gamma(d/2+1)}
\end{equation}
for the hyperspherical case. Here $d$ is the number of dimensions
and $\Gamma$ is the $\Gamma$ function.

The algorithm builds the Newick file using a recursive function traversing
the the nodes. Connections between nodes in different layers are made
if from a denser layer a cluster is contained at least at 80\% in a
cluster of a less dense layer. 

\subsection{Example}

\lstset{language=bash,
  caption={Example of the \emph{split\_sets\_to\_newick} tool},
  label=lst-ssnewick-example}
\begin{lstlisting}
  split_sets_to_newick 0 2 7 outfile 4 clusters/out-* > tree.dnd
\end{lstlisting}
Here we generate a Newick tree which we store in the \emph{tree.dnd}
whose lengths are density difference based, from an adaptive
clustering run whose output has been stored in \emph{outfile} and
whose \emph{split-sets} have been stored to \emph{clusters/out-X}
files. A \emph{minPoints} argument of 4 was used during the adaptive
clustering run, which was PCA based and operated on a seven
dimensional subspace spun by the principal components. 

\subsection{Implemenatation}
The interface for Newick tree generation is implemented in
\emph{split\_sets\_to\_newick.c}, algorithms for tree generation are
found in \emph{cluster\_io.c}.
